## 性能优化
- [1. 内存管理](#1)
- [2. 垃圾回收与常见的GC算法](#2)
- [3. V8引擎的垃圾回收](#3)
- [4. Google Performance 工具](#4)
- [5. 堆栈中代码执行流程](#5)
- [6. 如何精准测试js性能](#6)
--------
><h2 id='1'>1. 内存管理</h2>
1. 内存管理介绍
```js
`内存`: 有可读写单元组成, 表示一片可操作的控件
`管理`: 人为的区操作一片空间的申请,使用,释放
`内存管理`: 开发者主动申请空间,使用空间,释放空间
`管理流程`: 申请--使用--释放
// 申请
let obj = {}
// 使用
obj.name = 'tom'
// 释放
obj = null
```
2. js中的垃圾回收
```js
1. js中内存管理是自动的
2. 对象不再被引用时是垃圾
3. 对象不能从根上访问到时是垃圾
  // 根可以理解为 当前的全局变量对象

  function fn(){
    const name = 'tom'
    return name;
  }
  fn();
  // window 访问不到name
  
```

><h2 id='2'>2. 垃圾回收与常见的GC算法</h2>

```js
`GC` 就是垃圾回收的简写
常见的 `GC` 算法
1. 引用计数
2. 标记清除
3. 标记整理
4. 分代回收
```
1. `引用计数`
```js
`核心思想`: 设置引用数, 判断当前引用计数是否为`0`
  每多一个引用, 引用计数+1.
  引用计数为0, 立即回收.
'优点': 立即回收, 减少程序卡顿
`缺点`: 无法回收循环引用的对象, 资源消耗大
```
2. `标记清除`
```js
`核心思想`: 标记和清除两个阶段
  1. 遍历所有对象, 标记活动对象 (根能找到的)
  2. 遍历所有对象, 清除没有标记对象
  3. 回收响应空间
'优点': 可以回收循环引用的空间
`缺点`: 清除后, 空间碎片化, 浪费空间, 不会立即清除
  function fn(){
    // 执行完fn()后
    // obj1, obj2 有引用计数, 但是标记不到了
    const obj1 = {} 
    const obj2 = {} 
    obj1.name = obj2
    obj2.name = obj1
  }
  fn()
```
<img src='img/tag.jpg'>
<img src='img/tag2.jpg'>

3. `标记整理`
```js
`标记整理`可以看做标记清除的增强
清除前会先进行整理, 移动空间位置
`缺点`: 减少空间碎片化
```
<img src='img/tag3.jpg'>
<img src='img/tag4.jpg'>

><h2 id='3'>3. V8引擎的垃圾回收</h2>
认识V8
```js
  1. V8是一款主流的js引擎
  2. 即时编译
  3. V8内存设限 (64, 1.5G/ 32, 800M)
```
`V8垃圾回收策略`
```js
采用`分代回收`的思想
内存分为
  1. `新生代`(32M|16M)
  2. `老生代`(1.4G|700M) 活动时间长的对象 
```
<img src = 'img/v8.jpg'>

常用算法
```js
1. 分代回收
2. 空间复制
3. 标记清除
4. 标记整理
5. 标记增量
```
实现
```js
`新生代`回收实现: (空间换时间)
  1. 回收过程采用,复制算法 + 标记整理
  2. 新生代内存分为2个等大空间, from和to
  3. 活动对象存储在from
  4. from标记整理后拷贝至to
  5. from与to交换空间进行释放
  //回收细节说明
  1. 拷贝过程中可能出现晋升(将新生代移动到老生代)
  2. 一轮GC还存活的新生代需要晋升
  3. to空间使用率超过25%需要晋升
'老生代'回收实现
  主要采用算法`标记清除`, `标记整理`, `增量标记`(提高效率)

```
<img src = 'img/v8-2.jpg'>

><h2 id='4'>4. Performance 工具</h2>
```js
`界定问题的标准`
1. 内存泄漏: 内存持续升高
2. 内存膨胀: 在多数设备都存在性能问题
3. 频繁垃圾回收: 通过内存变化图进行分析

`监控内存的几种方式`
1. 浏览器任务管理器
2. Timeline 时序图记录
3. 堆快照查找分离DOM
4. 判断是否存在频繁的GC操作
  // GC 工作时程序是停止的
  (1). timeline中频繁的上升下降
  (2). 任务管理器中频繁的增加减小
```
<img src='img/p1.jpg'>
<img src='img/p2.jpg'>
<img src='img/p3.jpg'>
<img src='img/p4.jpg'>

><h2 id='5'>5. 堆栈中代码执行流程</h2>
<img src= 'img/ecstack.jpg'>

><h2 id='6'>6. 如何精准测试js性能</h2>
```js
如何精准测试js性能
  本质就是采用大量执行样本进行数学统计和分析
`jsperf`: https://jsperf.com/

`jsBench`: https://jsbench.me/
```
<img src='img/jsbench.jpg'>